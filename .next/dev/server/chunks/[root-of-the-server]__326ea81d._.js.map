{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/lib/firebase-admin.js"],"sourcesContent":["import admin from 'firebase-admin'\n\n// Verificar se j√° foi inicializado\nif (!admin.apps.length) {\n  try {\n    // Tentar inicializar com credenciais do ambiente\n    if (process.env.FIREBASE_ADMIN_CREDENTIALS) {\n      const serviceAccount = JSON.parse(process.env.FIREBASE_ADMIN_CREDENTIALS)\n      \n      admin.initializeApp({\n        credential: admin.credential.cert(serviceAccount),\n        databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL\n      })\n    } \n    // Fallback: usar vari√°veis individuais\n    else if (process.env.FIREBASE_PROJECT_ID) {\n      admin.initializeApp({\n        credential: admin.credential.cert({\n          projectId: process.env.FIREBASE_PROJECT_ID,\n          clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n          privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n')\n        }),\n        databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL\n      })\n    }\n    // Desenvolvimento: usar emulador ou credenciais padr√£o\n    else {\n      console.warn('‚ö†Ô∏è Firebase Admin: Usando modo de desenvolvimento')\n      admin.initializeApp({\n        projectId: 'demo-project'\n      })\n    }\n\n    console.log('‚úÖ Firebase Admin inicializado com sucesso')\n  } catch (error) {\n    console.error('‚ùå Erro ao inicializar Firebase Admin:', error)\n  }\n}\n\n// Exportar inst√¢ncias\nexport const db = admin.firestore()\nexport const auth = admin.auth()\nexport const storage = admin.storage()\n\nexport default admin"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,mCAAmC;AACnC,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,iDAAiD;QACjD,IAAI,QAAQ,GAAG,CAAC,0BAA0B,EAAE;YAC1C,MAAM,iBAAiB,KAAK,KAAK,CAAC,QAAQ,GAAG,CAAC,0BAA0B;YAExE,sIAAK,CAAC,aAAa,CAAC;gBAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;gBAClC,aAAa,QAAQ,GAAG,CAAC,iCAAiC;YAC5D;QACF,OAEK,IAAI,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YACxC,sIAAK,CAAC,aAAa,CAAC;gBAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;oBAChC,WAAW,QAAQ,GAAG,CAAC,mBAAmB;oBAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;oBAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;gBAChE;gBACA,aAAa,QAAQ,GAAG,CAAC,iCAAiC;YAC5D;QACF,OAEK;YACH,QAAQ,IAAI,CAAC;YACb,sIAAK,CAAC,aAAa,CAAC;gBAClB,WAAW;YACb;QACF;QAEA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;IACzD;AACF;AAGO,MAAM,KAAK,sIAAK,CAAC,SAAS;AAC1B,MAAM,OAAO,sIAAK,CAAC,IAAI;AACvB,MAAM,UAAU,sIAAK,CAAC,OAAO;uCAErB,sIAAK","debugId":null}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/lib/auth.js"],"sourcesContent":["import jwt from 'jsonwebtoken'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'sua-chave-secreta-super-segura-aqui-2024'\n\n/**\n * Gerar token JWT\n */\nexport function gerarToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, {\n    expiresIn: '7d' // Token v√°lido por 7 dias\n  })\n}\n\n/**\n * Verificar token JWT\n */\nexport function verificarTokenJWT(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET)\n  } catch (error) {\n    return null\n  }\n}\n\n/**\n * Extrair token do header Authorization\n */\nexport function extrairToken(request) {\n  const authHeader = request.headers.get('Authorization')\n  \n  if (!authHeader) {\n    return null\n  }\n\n  // Formato: \"Bearer TOKEN\"\n  const parts = authHeader.split(' ')\n  \n  if (parts.length !== 2 || parts[0] !== 'Bearer') {\n    return null\n  }\n\n  return parts[1]\n}\n\n/**\n * Verificar token da requisi√ß√£o e retornar usu√°rio\n */\nexport async function verificarToken(request) {\n  try {\n    const token = extrairToken(request)\n    \n    if (!token) {\n      return null\n    }\n\n    const decoded = verificarTokenJWT(token)\n    \n    if (!decoded) {\n      return null\n    }\n\n    return {\n      uid: decoded.uid,\n      email: decoded.email,\n      nome: decoded.nome\n    }\n  } catch (error) {\n    console.error('Erro ao verificar token:', error)\n    return null\n  }\n}\n\n/**\n * Middleware de autentica√ß√£o\n */\nexport async function requireAuth(request) {\n  const usuario = await verificarToken(request)\n  \n  if (!usuario) {\n    throw new Error('N√£o autorizado')\n  }\n\n  return usuario\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAKtC,SAAS,WAAW,OAAO;IAChC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QACnC,WAAW,KAAK,0BAA0B;IAC5C;AACF;AAKO,SAAS,kBAAkB,KAAK;IACrC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAKO,SAAS,aAAa,OAAO;IAClC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEvC,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IAEA,0BAA0B;IAC1B,MAAM,QAAQ,WAAW,KAAK,CAAC;IAE/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU;QAC/C,OAAO;IACT;IAEA,OAAO,KAAK,CAAC,EAAE;AACjB;AAKO,eAAe,eAAe,OAAO;IAC1C,IAAI;QACF,MAAM,QAAQ,aAAa;QAE3B,IAAI,CAAC,OAAO;YACV,OAAO;QACT;QAEA,MAAM,UAAU,kBAAkB;QAElC,IAAI,CAAC,SAAS;YACZ,OAAO;QACT;QAEA,OAAO;YACL,KAAK,QAAQ,GAAG;YAChB,OAAO,QAAQ,KAAK;YACpB,MAAM,QAAQ,IAAI;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;IACT;AACF;AAKO,eAAe,YAAY,OAAO;IACvC,MAAM,UAAU,MAAM,eAAe;IAErC,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/app/api/auth/login/route.js"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { db } from '@/lib/firebase-admin'\nimport { gerarToken } from '@/lib/auth'\nimport bcrypt from 'bcryptjs'\n\nexport async function POST(request) {\n  try {\n    const body = await request.json()\n    const { email, senha } = body\n\n    if (!email || !senha) {\n      return NextResponse.json(\n        { erro: 'Email e senha s√£o obrigat√≥rios' },\n        { status: 400 }\n      )\n    }\n\n    // Buscar usu√°rio por email\n    const snapshot = await db.collection('users')\n      .where('email', '==', email.toLowerCase())\n      .limit(1)\n      .get()\n\n    if (snapshot.empty) {\n      return NextResponse.json(\n        { erro: 'Email ou senha incorretos' },\n        { status: 401 }\n      )\n    }\n\n    const userDoc = snapshot.docs[0]\n    const userData = userDoc.data()\n\n    // Verificar senha\n    const senhaValida = await bcrypt.compare(senha, userData.senha)\n    \n    if (!senhaValida) {\n      return NextResponse.json(\n        { erro: 'Email ou senha incorretos' },\n        { status: 401 }\n      )\n    }\n\n    // Gerar token JWT\n    const token = gerarToken({\n      uid: userDoc.id,\n      email: userData.email,\n      nome: userData.nome\n    })\n\n    // Atualizar √∫ltimo login\n    await db.collection('users').doc(userDoc.id).update({\n      ultimoLogin: new Date()\n    })\n\n    // Registrar atividade\n    await db.collection('atividades').add({\n      userId: userDoc.id,\n      tipo: 'login',\n      descricao: 'Login realizado com sucesso',\n      criadoEm: new Date()\n    })\n\n    return NextResponse.json({\n      sucesso: true,\n      token,\n      usuario: {\n        uid: userDoc.id,\n        nome: userData.nome,\n        email: userData.email,\n        avatar: userData.avatar || 'üë§'\n      }\n    })\n\n  } catch (error) {\n    console.error('Erro ao fazer login:', error)\n    return NextResponse.json(\n      { erro: 'Erro ao processar login' },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG;QAEzB,IAAI,CAAC,SAAS,CAAC,OAAO;YACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,MAAM;YAAiC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,WAAW,MAAM,gIAAE,CAAC,UAAU,CAAC,SAClC,KAAK,CAAC,SAAS,MAAM,MAAM,WAAW,IACtC,KAAK,CAAC,GACN,GAAG;QAEN,IAAI,SAAS,KAAK,EAAE;YAClB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,MAAM;YAA4B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,SAAS,IAAI,CAAC,EAAE;QAChC,MAAM,WAAW,QAAQ,IAAI;QAE7B,kBAAkB;QAClB,MAAM,cAAc,MAAM,8IAAM,CAAC,OAAO,CAAC,OAAO,SAAS,KAAK;QAE9D,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,MAAM;YAA4B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,QAAQ,IAAA,2HAAU,EAAC;YACvB,KAAK,QAAQ,EAAE;YACf,OAAO,SAAS,KAAK;YACrB,MAAM,SAAS,IAAI;QACrB;QAEA,yBAAyB;QACzB,MAAM,gIAAE,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC,QAAQ,EAAE,EAAE,MAAM,CAAC;YAClD,aAAa,IAAI;QACnB;QAEA,sBAAsB;QACtB,MAAM,gIAAE,CAAC,UAAU,CAAC,cAAc,GAAG,CAAC;YACpC,QAAQ,QAAQ,EAAE;YAClB,MAAM;YACN,WAAW;YACX,UAAU,IAAI;QAChB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,SAAS;gBACP,KAAK,QAAQ,EAAE;gBACf,MAAM,SAAS,IAAI;gBACnB,OAAO,SAAS,KAAK;gBACrB,QAAQ,SAAS,MAAM,IAAI;YAC7B;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,MAAM;QAA0B,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}