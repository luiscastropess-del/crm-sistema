{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/lib/utils/jwt.js"],"sourcesContent":["// lib/utils/jwt.js\nimport jwt from 'jsonwebtoken'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'seu-secret-super-seguro-aqui'\nconst JWT_EXPIRES_IN = '7d'\n\n// Gerar token JWT\nexport function generateToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\n}\n\n// Verificar token JWT\nexport function verifyToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET)\n  } catch (error) {\n    return null\n  }\n}\n\n// Decodificar token sem verificar (útil para debug)\nexport function decodeToken(token) {\n  try {\n    return jwt.decode(token)\n  } catch (error) {\n    return null\n  }\n}\n\n// Extrair token do header Authorization\nexport function extractToken(authHeader) {\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return null\n  }\n  return authHeader.substring(7)\n}"],"names":[],"mappings":"AAAA,mBAAmB;;;;;;;;;;;AACnB;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AAGhB,SAAS,cAAc,OAAO;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAe;AACnE;AAGO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAGO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAGO,SAAS,aAAa,UAAU;IACrC,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;QACpD,OAAO;IACT;IACA,OAAO,WAAW,SAAS,CAAC;AAC9B","debugId":null}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/lib/firebase/admin.js"],"sourcesContent":["// lib/firebase/admin.js\nimport admin from 'firebase-admin'\n\n// Inicializar Firebase Admin apenas uma vez\nif (!admin.apps.length) {\n  try {\n    admin.initializeApp({\n      credential: admin.credential.cert({\n        projectId: process.env.FIREBASE_PROJECT_ID,\n        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n        privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\n      }),\n      databaseURL: process.env.FIREBASE_DATABASE_URL,\n    })\n    console.log('✅ Firebase Admin inicializado')\n  } catch (error) {\n    console.error('❌ Erro ao inicializar Firebase Admin:', error)\n  }\n}\n\n// Exportar instâncias\nexport const db = admin.firestore()\nexport const auth = admin.auth()\nexport const storage = admin.storage()\n\n// Helper functions para Firestore\nexport const collections = {\n  users: () => db.collection('users'),\n  clientes: () => db.collection('clientes'),\n  leads: () => db.collection('leads'),\n  vendas: () => db.collection('vendas'),\n  atividades: () => db.collection('atividades'),\n}\n\n// Função para converter Timestamp do Firestore\nexport const convertTimestamp = (timestamp) => {\n  if (!timestamp) return null\n  return timestamp.toDate ? timestamp.toDate().toISOString() : timestamp\n}\n\n// Função para formatar documento do Firestore\nexport const formatDoc = (doc) => {\n  if (!doc.exists) return null\n  const data = doc.data()\n  return {\n    id: doc.id,\n    ...data,\n    criadoEm: convertTimestamp(data.criadoEm),\n    atualizadoEm: convertTimestamp(data.atualizadoEm),\n  }\n}\n\nexport default admin"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;;;;;;;;;;;AACxB;;AAEA,4CAA4C;AAC5C,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,IAAI;QACF,sIAAK,CAAC,aAAa,CAAC;YAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;gBAChC,WAAW,QAAQ,GAAG,CAAC,mBAAmB;gBAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;gBAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;YAChE;YACA,aAAa,QAAQ,GAAG,CAAC,qBAAqB;QAChD;QACA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;IACzD;AACF;AAGO,MAAM,KAAK,sIAAK,CAAC,SAAS;AAC1B,MAAM,OAAO,sIAAK,CAAC,IAAI;AACvB,MAAM,UAAU,sIAAK,CAAC,OAAO;AAG7B,MAAM,cAAc;IACzB,OAAO,IAAM,GAAG,UAAU,CAAC;IAC3B,UAAU,IAAM,GAAG,UAAU,CAAC;IAC9B,OAAO,IAAM,GAAG,UAAU,CAAC;IAC3B,QAAQ,IAAM,GAAG,UAAU,CAAC;IAC5B,YAAY,IAAM,GAAG,UAAU,CAAC;AAClC;AAGO,MAAM,mBAAmB,CAAC;IAC/B,IAAI,CAAC,WAAW,OAAO;IACvB,OAAO,UAAU,MAAM,GAAG,UAAU,MAAM,GAAG,WAAW,KAAK;AAC/D;AAGO,MAAM,YAAY,CAAC;IACxB,IAAI,CAAC,IAAI,MAAM,EAAE,OAAO;IACxB,MAAM,OAAO,IAAI,IAAI;IACrB,OAAO;QACL,IAAI,IAAI,EAAE;QACV,GAAG,IAAI;QACP,UAAU,iBAAiB,KAAK,QAAQ;QACxC,cAAc,iBAAiB,KAAK,YAAY;IAClD;AACF;uCAEe,sIAAK","debugId":null}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/lib/middleware/auth.js"],"sourcesContent":["// lib/middleware/auth.js\nimport { NextResponse } from 'next/server'\nimport { verifyToken, extractToken } from '@/lib/utils/jwt'\nimport { collections } from '@/lib/firebase/admin'\n\n// Middleware para verificar autenticação\nexport async function authenticate(request) {\n  try {\n    // Extrair token do header\n    const authHeader = request.headers.get('authorization')\n    const token = extractToken(authHeader)\n\n    if (!token) {\n      return {\n        error: 'Token não fornecido',\n        status: 401\n      }\n    }\n\n    // Verificar token\n    const decoded = verifyToken(token)\n    if (!decoded) {\n      return {\n        error: 'Token inválido ou expirado',\n        status: 401\n      }\n    }\n\n    // Buscar usuário no banco\n    const userDoc = await collections.users().doc(decoded.userId).get()\n    \n    if (!userDoc.exists) {\n      return {\n        error: 'Usuário não encontrado',\n        status: 404\n      }\n    }\n\n    // Retornar dados do usuário\n    return {\n      user: {\n        id: userDoc.id,\n        ...userDoc.data()\n      }\n    }\n  } catch (error) {\n    console.error('Erro na autenticação:', error)\n    return {\n      error: 'Erro ao verificar autenticação',\n      status: 500\n    }\n  }\n}\n\n// Helper para criar resposta de erro\nexport function unauthorizedResponse(message = 'Não autorizado') {\n  return NextResponse.json(\n    { error: message },\n    { status: 401 }\n  )\n}\n\n// Helper para criar resposta de sucesso\nexport function successResponse(data, status = 200) {\n  return NextResponse.json(data, { status })\n}\n\n// Helper para criar resposta de erro\nexport function errorResponse(message, status = 500) {\n  return NextResponse.json(\n    { error: message },\n    { status }\n  )\n}"],"names":[],"mappings":"AAAA,yBAAyB;;;;;;;;;;;AACzB;AACA;AACA;;;;AAGO,eAAe,aAAa,OAAO;IACxC,IAAI;QACF,0BAA0B;QAC1B,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,MAAM,QAAQ,IAAA,qIAAY,EAAC;QAE3B,IAAI,CAAC,OAAO;YACV,OAAO;gBACL,OAAO;gBACP,QAAQ;YACV;QACF;QAEA,kBAAkB;QAClB,MAAM,UAAU,IAAA,oIAAW,EAAC;QAC5B,IAAI,CAAC,SAAS;YACZ,OAAO;gBACL,OAAO;gBACP,QAAQ;YACV;QACF;QAEA,0BAA0B;QAC1B,MAAM,UAAU,MAAM,yIAAW,CAAC,KAAK,GAAG,GAAG,CAAC,QAAQ,MAAM,EAAE,GAAG;QAEjE,IAAI,CAAC,QAAQ,MAAM,EAAE;YACnB,OAAO;gBACL,OAAO;gBACP,QAAQ;YACV;QACF;QAEA,4BAA4B;QAC5B,OAAO;YACL,MAAM;gBACJ,IAAI,QAAQ,EAAE;gBACd,GAAG,QAAQ,IAAI,EAAE;YACnB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;YACL,OAAO;YACP,QAAQ;QACV;IACF;AACF;AAGO,SAAS,qBAAqB,UAAU,gBAAgB;IAC7D,OAAO,gJAAY,CAAC,IAAI,CACtB;QAAE,OAAO;IAAQ,GACjB;QAAE,QAAQ;IAAI;AAElB;AAGO,SAAS,gBAAgB,IAAI,EAAE,SAAS,GAAG;IAChD,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAAE;IAAO;AAC1C;AAGO,SAAS,cAAc,OAAO,EAAE,SAAS,GAAG;IACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;QAAE,OAAO;IAAQ,GACjB;QAAE;IAAO;AAEb","debugId":null}},
    {"offset": {"line": 260, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luisc/Documents/PROJETOS/crm-sistema/app/api/dashboard/stats/route.js"],"sourcesContent":["// app/api/dashboard/stats/route.js\nimport { NextResponse } from 'next/server'\nimport { authenticate } from '@/lib/middleware/auth'\nimport { collections } from '@/lib/firebase/admin'\n\nexport async function GET(request) {\n  try {\n    const authResult = await authenticate(request)\n    if (authResult.error) {\n      return NextResponse.json(\n        { error: authResult.error },\n        { status: authResult.status }\n      )\n    }\n\n    const { user } = authResult\n\n    // Buscar dados em paralelo\n    const [clientesSnapshot, leadsSnapshot, vendasSnapshot] = await Promise.all([\n      collections.clientes().where('userId', '==', user.id).get(),\n      collections.leads().where('userId', '==', user.id).get(),\n      collections.vendas().where('userId', '==', user.id).get()\n    ])\n\n    // Contar totais\n    const totalClientes = clientesSnapshot.size\n    const totalLeads = leadsSnapshot.docs.filter(doc => \n      doc.data().status !== 'convertido' && doc.data().status !== 'perdido'\n    ).length\n\n    // Calcular vendas do mês atual\n    const agora = new Date()\n    const inicioMes = new Date(agora.getFullYear(), agora.getMonth(), 1)\n    \n    const vendasMes = vendasSnapshot.docs\n      .filter(doc => {\n        const venda = doc.data()\n        const dataVenda = new Date(venda.dataVenda || venda.criadoEm)\n        return dataVenda >= inicioMes && venda.status === 'pago'\n      })\n      .reduce((total, doc) => total + (doc.data().valor || 0), 0)\n\n    // Calcular taxa de conversão\n    const leadsConvertidos = leadsSnapshot.docs.filter(doc => \n      doc.data().status === 'convertido'\n    ).length\n    const totalLeadsHistorico = leadsSnapshot.size\n    const taxaConversao = totalLeadsHistorico > 0 \n      ? Math.round((leadsConvertidos / totalLeadsHistorico) * 100) \n      : 0\n\n    // Calcular crescimento (comparar com mês anterior)\n    const inicioMesAnterior = new Date(agora.getFullYear(), agora.getMonth() - 1, 1)\n    const fimMesAnterior = new Date(agora.getFullYear(), agora.getMonth(), 0)\n    \n    const vendasMesAnterior = vendasSnapshot.docs\n      .filter(doc => {\n        const venda = doc.data()\n        const dataVenda = new Date(venda.dataVenda || venda.criadoEm)\n        return dataVenda >= inicioMesAnterior && dataVenda <= fimMesAnterior && venda.status === 'pago'\n      })\n      .reduce((total, doc) => total + (doc.data().valor || 0), 0)\n\n    const crescimentoVendas = vendasMesAnterior > 0\n      ? Math.round(((vendasMes - vendasMesAnterior) / vendasMesAnterior) * 100)\n      : 0\n\n    return NextResponse.json({\n      success: true,\n      totalClientes,\n      totalLeads,\n      vendasMes,\n      taxaConversao,\n      crescimentoVendas,\n      timestamp: new Date().toISOString()\n    })\n\n  } catch (error) {\n    console.error('Erro ao buscar estatísticas:', error)\n    return NextResponse.json(\n      { error: 'Erro ao buscar estatísticas' },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":"AAAA,mCAAmC;;;;;AACnC;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,aAAa,MAAM,IAAA,2IAAY,EAAC;QACtC,IAAI,WAAW,KAAK,EAAE;YACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,WAAW,KAAK;YAAC,GAC1B;gBAAE,QAAQ,WAAW,MAAM;YAAC;QAEhC;QAEA,MAAM,EAAE,IAAI,EAAE,GAAG;QAEjB,2BAA2B;QAC3B,MAAM,CAAC,kBAAkB,eAAe,eAAe,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC1E,yIAAW,CAAC,QAAQ,GAAG,KAAK,CAAC,UAAU,MAAM,KAAK,EAAE,EAAE,GAAG;YACzD,yIAAW,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,MAAM,KAAK,EAAE,EAAE,GAAG;YACtD,yIAAW,CAAC,MAAM,GAAG,KAAK,CAAC,UAAU,MAAM,KAAK,EAAE,EAAE,GAAG;SACxD;QAED,gBAAgB;QAChB,MAAM,gBAAgB,iBAAiB,IAAI;QAC3C,MAAM,aAAa,cAAc,IAAI,CAAC,MAAM,CAAC,CAAA,MAC3C,IAAI,IAAI,GAAG,MAAM,KAAK,gBAAgB,IAAI,IAAI,GAAG,MAAM,KAAK,WAC5D,MAAM;QAER,+BAA+B;QAC/B,MAAM,QAAQ,IAAI;QAClB,MAAM,YAAY,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,IAAI;QAElE,MAAM,YAAY,eAAe,IAAI,CAClC,MAAM,CAAC,CAAA;YACN,MAAM,QAAQ,IAAI,IAAI;YACtB,MAAM,YAAY,IAAI,KAAK,MAAM,SAAS,IAAI,MAAM,QAAQ;YAC5D,OAAO,aAAa,aAAa,MAAM,MAAM,KAAK;QACpD,GACC,MAAM,CAAC,CAAC,OAAO,MAAQ,QAAQ,CAAC,IAAI,IAAI,GAAG,KAAK,IAAI,CAAC,GAAG;QAE3D,6BAA6B;QAC7B,MAAM,mBAAmB,cAAc,IAAI,CAAC,MAAM,CAAC,CAAA,MACjD,IAAI,IAAI,GAAG,MAAM,KAAK,cACtB,MAAM;QACR,MAAM,sBAAsB,cAAc,IAAI;QAC9C,MAAM,gBAAgB,sBAAsB,IACxC,KAAK,KAAK,CAAC,AAAC,mBAAmB,sBAAuB,OACtD;QAEJ,mDAAmD;QACnD,MAAM,oBAAoB,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,KAAK,GAAG;QAC9E,MAAM,iBAAiB,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,IAAI;QAEvE,MAAM,oBAAoB,eAAe,IAAI,CAC1C,MAAM,CAAC,CAAA;YACN,MAAM,QAAQ,IAAI,IAAI;YACtB,MAAM,YAAY,IAAI,KAAK,MAAM,SAAS,IAAI,MAAM,QAAQ;YAC5D,OAAO,aAAa,qBAAqB,aAAa,kBAAkB,MAAM,MAAM,KAAK;QAC3F,GACC,MAAM,CAAC,CAAC,OAAO,MAAQ,QAAQ,CAAC,IAAI,IAAI,GAAG,KAAK,IAAI,CAAC,GAAG;QAE3D,MAAM,oBAAoB,oBAAoB,IAC1C,KAAK,KAAK,CAAC,AAAC,CAAC,YAAY,iBAAiB,IAAI,oBAAqB,OACnE;QAEJ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA;YACA;YACA;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA8B,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}