"use strict";(()=>{var e={};e.id=4983,e.ids=[4983],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5617:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>l});var o={};a.r(o),a.d(o,{GET:()=>u});var r=a(9303),s=a(8716),i=a(670),n=a(7070);async function u(e){try{let t=await Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(!t)return n.NextResponse.json({erro:"N\xe3o autorizado"},{status:401});let[a,o,r,s]=await Promise.all([Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("clientes").where("userId","==",t.uid).get(),Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("leads").where("userId","==",t.uid).get(),Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("vendas").where("userId","==",t.uid).get(),Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("tarefas").where("userId","==",t.uid).get()]),i=0,u=0;a.forEach(e=>{let t=e.data();"ativo"===t.status?i++:u++});let c={},d={};o.forEach(e=>{let t=e.data();c[t.status]=(c[t.status]||0)+1,d[t.origem]=(d[t.origem]||0)+1});let l=0,p=0,m={},f={},O=new Date().getMonth(),h=new Date().getFullYear();r.forEach(e=>{let t=e.data();if("concluida"===t.status){l+=t.valor||0;let e=t.criadoEm?.toDate();e&&e.getMonth()===O&&e.getFullYear()===h&&(p+=t.valor||0)}m[t.status]=(m[t.status]||0)+1;let a=t.criadoEm?.toDate().toLocaleDateString("pt-BR",{month:"short",year:"numeric"});a&&(f[a]=(f[a]||0)+(t.valor||0))});let v=0,E=0,D=0,b=new Date;s.forEach(e=>{let t=e.data();if("concluida"===t.status)E++;else{v++;let e=t.dataVencimento?.toDate();e&&e<b&&D++}});let g=o.size>0?((c.convertido||0)/o.size*100).toFixed(2):0,w=a.size>0?(i/a.size*100).toFixed(2):0,N=r.size>0?(l/r.size).toFixed(2):0;return n.NextResponse.json({sucesso:!0,estatisticas:{clientes:{total:a.size,ativos:i,inativos:u,taxaAtivos:w},leads:{total:o.size,porStatus:c,porOrigem:d,taxaConversao:g},vendas:{total:r.size,receitaTotal:l,receitaMes:p,ticketMedio:N,porStatus:m,porMes:f},tarefas:{total:s.size,pendentes:v,concluidas:E,atrasadas:D}}})}catch(e){return console.error("Erro ao buscar estat\xedsticas:",e),n.NextResponse.json({erro:"Erro ao buscar estat\xedsticas"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}();let c=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/estatisticas/route",pathname:"/api/estatisticas",filename:"route",bundlePath:"app/api/estatisticas/route"},resolvedPagePath:"C:\\Users\\luisc\\Documents\\PROJETOS\\crm-sistema\\app\\api\\estatisticas\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:p}=c,m="/api/estatisticas/route";function f(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:l})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>a(5617));module.exports=o})();