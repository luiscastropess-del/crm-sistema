"use strict";(()=>{var e={};e.id=1541,e.ids=[1541],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6363:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>p,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>l,serverHooks:()=>O,staticGenerationAsyncStorage:()=>m});var t={};r.r(t),r.d(t,{GET:()=>c,PATCH:()=>d,POST:()=>u});var a=r(9303),i=r(8716),n=r(670),s=r(7070);async function c(e){try{let o=await Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(!o)return s.NextResponse.json({erro:"N\xe3o autorizado"},{status:401});let{searchParams:r}=new URL(e.url),t=r.get("lida"),a=Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("notificacoes").where("userId","==",o.uid).orderBy("criadoEm","desc").limit(50);null!==t&&(a=a.where("lida","==","true"===t));let i=await a.get(),n=[];i.forEach(e=>{n.push({id:e.id,...e.data(),criadoEm:e.data().criadoEm?.toDate().toISOString()})});let c=await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("notificacoes").where("userId","==",o.uid).where("lida","==",!1).get();return s.NextResponse.json({sucesso:!0,total:n.length,naoLidas:c.size,notificacoes:n})}catch(e){return console.error("Erro ao buscar notifica\xe7\xf5es:",e),s.NextResponse.json({erro:"Erro ao buscar notifica\xe7\xf5es"},{status:500})}}async function u(e){try{let o=await Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(!o)return s.NextResponse.json({erro:"N\xe3o autorizado"},{status:401});let{titulo:r,mensagem:t,tipo:a="info",link:i}=await e.json();if(!r||!t)return s.NextResponse.json({erro:"T\xedtulo e mensagem s\xe3o obrigat\xf3rios"},{status:400});let n=await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("notificacoes").add({userId:o.uid,titulo:r,mensagem:t,tipo:a,link:i||null,lida:!1,criadoEm:new Date});return s.NextResponse.json({sucesso:!0,id:n.id,mensagem:"Notifica\xe7\xe3o criada com sucesso"},{status:201})}catch(e){return console.error("Erro ao criar notifica\xe7\xe3o:",e),s.NextResponse.json({erro:"Erro ao criar notifica\xe7\xe3o"},{status:500})}}async function d(e){try{let o=await Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(!o)return s.NextResponse.json({erro:"N\xe3o autorizado"},{status:401});let r=await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("notificacoes").where("userId","==",o.uid).where("lida","==",!1).get(),t=Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).batch();return r.forEach(e=>{t.update(e.ref,{lida:!0})}),await t.commit(),s.NextResponse.json({sucesso:!0,mensagem:`${r.size} notifica\xe7\xf5es marcadas como lidas`})}catch(e){return console.error("Erro ao marcar notifica\xe7\xf5es como lidas:",e),s.NextResponse.json({erro:"Erro ao marcar notifica\xe7\xf5es como lidas"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}();let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/notificacoes/route",pathname:"/api/notificacoes",filename:"route",bundlePath:"app/api/notificacoes/route"},resolvedPagePath:"C:\\Users\\luisc\\Documents\\PROJETOS\\crm-sistema\\app\\api\\notificacoes\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:O}=l,p="/api/notificacoes/route";function h(){return(0,n.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:m})}}};var o=require("../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[9276,5972],()=>r(6363));module.exports=t})();