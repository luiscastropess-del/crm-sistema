"use strict";(()=>{var e={};e.id=458,e.ids=[458],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},5259:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>f,patchFetch:()=>O,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var t={};r.r(t),r.d(t,{POST:()=>c});var o=r(9303),n=r(8716),s=r(670),i=r(7070),u=r(2023),d=r.n(u);async function c(e){try{let a=await Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(!a)return i.NextResponse.json({erro:"N\xe3o autorizado"},{status:401});let{senhaAtual:r,novaSenha:t}=await e.json();if(!r||!t)return i.NextResponse.json({erro:"Senha atual e nova senha s\xe3o obrigat\xf3rias"},{status:400});if(t.length<6)return i.NextResponse.json({erro:"Nova senha deve ter no m\xednimo 6 caracteres"},{status:400});let o=await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("users").doc(a.uid).get();if(!o.exists)return i.NextResponse.json({erro:"Usu\xe1rio n\xe3o encontrado"},{status:404});let n=o.data();if(!await d().compare(r,n.senha))return i.NextResponse.json({erro:"Senha atual incorreta"},{status:401});let s=await d().hash(t,10);return await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("users").doc(a.uid).update({senha:s,atualizadoEm:new Date}),await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("atividades").add({userId:a.uid,tipo:"senha_alterada",descricao:"Senha alterada com sucesso",criadoEm:new Date}),await Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("notificacoes").add({userId:a.uid,titulo:"Senha alterada",mensagem:"Sua senha foi alterada com sucesso",tipo:"sucesso",lida:!1,criadoEm:new Date}),i.NextResponse.json({sucesso:!0,mensagem:"Senha alterada com sucesso"})}catch(e){return console.error("Erro ao alterar senha:",e),i.NextResponse.json({erro:"Erro ao alterar senha"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}();let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/perfil/alterar-senha/route",pathname:"/api/perfil/alterar-senha",filename:"route",bundlePath:"app/api/perfil/alterar-senha/route"},resolvedPagePath:"C:\\Users\\luisc\\Documents\\PROJETOS\\crm-sistema\\app\\api\\perfil\\alterar-senha\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:m}=l,f="/api/perfil/alterar-senha/route";function O(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[9276,5972,2023],()=>r(5259));module.exports=t})();