"use strict";(()=>{var e={};e.id=18,e.ids=[18],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8751:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>w,serverHooks:()=>D,staticGenerationAsyncStorage:()=>h});var o={};a.r(o),a.d(o,{GET:()=>c});var r=a(9303),n=a(8716),i=a(670),s=a(7070);async function c(e){try{let t,a;let o=await Object(function(){var e=Error("Cannot find module '@appauth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(!o)return s.NextResponse.json({erro:"N\xe3o autorizado"},{status:401});let{searchParams:r}=new URL(e.url),n=r.get("tipo")||"vendas",i=r.get("periodo")||"mes",c=r.get("dataInicio"),w=r.get("dataFim"),p={},h=new Date;if(c&&w)t=new Date(c),a=new Date(w);else switch(i){case"hoje":t=new Date(h.setHours(0,0,0,0)),a=new Date;break;case"semana":t=new Date(h.setDate(h.getDate()-7)),a=new Date;break;case"mes":default:t=new Date(h.setMonth(h.getMonth()-1)),a=new Date;break;case"trimestre":t=new Date(h.setMonth(h.getMonth()-3)),a=new Date;break;case"ano":t=new Date(h.setFullYear(h.getFullYear()-1)),a=new Date}return"vendas"===n?p=await d(o.uid,t,a):"clientes"===n?p=await u(o.uid,t,a):"leads"===n?p=await l(o.uid,t,a):"completo"===n&&(p=await m(o.uid,t,a)),s.NextResponse.json({sucesso:!0,tipo:n,periodo:i,dataInicio:t.toISOString(),dataFim:a.toISOString(),dados:p})}catch(e){return console.error("Erro ao gerar relat\xf3rio:",e),s.NextResponse.json({erro:"Erro ao gerar relat\xf3rio"},{status:500})}}async function d(e,t,a){let o=Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("vendas"),r=await o.where("userId","==",e).where("criadoEm",">=",t).where("criadoEm","<=",a).get(),n=0,i=0,s={concluida:0,pendente:0,cancelada:0},c={},d={};return r.forEach(e=>{let t=e.data();n++,"concluida"===t.status&&(i+=t.valor||0),s[t.status]=(s[t.status]||0)+1;let a=new Date(t.criadoEm.toDate()).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});c[a]=(c[a]||0)+1,d[t.formaPagamento]=(d[t.formaPagamento]||0)+1}),{totalVendas:n,totalReceita:i,ticketMedio:n>0?i/n:0,vendasPorStatus:s,vendasPorMes:c,vendasPorFormaPagamento:d}}async function u(e,t,a){let o=Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("clientes"),r=await o.where("userId","==",e).where("criadoEm",">=",t).where("criadoEm","<=",a).get(),n=0,i={ativo:0,inativo:0},s={};return r.forEach(e=>{let t=e.data();n++,i[t.status]=(i[t.status]||0)+1;let a=new Date(t.criadoEm.toDate()).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});s[a]=(s[a]||0)+1}),{totalClientes:n,clientesPorStatus:i,clientesPorMes:s,taxaAtivos:n>0?(i.ativo/n*100).toFixed(2):0}}async function l(e,t,a){let o=Object(function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}()).collection("leads"),r=await o.where("userId","==",e).where("criadoEm",">=",t).where("criadoEm","<=",a).get(),n=0,i={},s={},c={};return r.forEach(e=>{let t=e.data();n++,i[t.status]=(i[t.status]||0)+1,s[t.origem]=(s[t.origem]||0)+1;let a=new Date(t.criadoEm.toDate()).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});c[a]=(c[a]||0)+1}),{totalLeads:n,leadsPorStatus:i,leadsPorOrigem:s,leadsPorMes:c,taxaConversao:n>0?((i.convertido||0)/n*100).toFixed(2):0}}async function m(e,t,a){let[o,r,n]=await Promise.all([d(e,t,a),u(e,t,a),l(e,t,a)]);return{vendas:o,clientes:r,leads:n,resumo:{totalReceita:o.totalReceita,totalClientes:r.totalClientes,totalLeads:n.totalLeads,totalVendas:o.totalVendas}}}(function(){var e=Error("Cannot find module '@appauth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/firebase-admin'");throw e.code="MODULE_NOT_FOUND",e}();let w=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/relatorios/route",pathname:"/api/relatorios",filename:"route",bundlePath:"app/api/relatorios/route"},resolvedPagePath:"C:\\Users\\luisc\\Documents\\PROJETOS\\crm-sistema\\app\\api\\relatorios\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:D}=w,f="/api/relatorios/route";function g(){return(0,i.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>a(8751));module.exports=o})();