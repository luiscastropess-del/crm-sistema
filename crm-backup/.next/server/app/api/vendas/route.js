"use strict";(()=>{var e={};e.id=4742,e.ids=[4742],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8451:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>O});var a={};t.r(a),t.d(a,{GET:()=>s,POST:()=>c});var o=t(9303),n=t(8716),i=t(670),d=t(7070);async function s(e){try{let r=await Object(function(){var e=Error("Cannot find module '@/lib/middleware/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(r.error)return d.NextResponse.json({error:r.error},{status:r.status});let{user:t}=r,{searchParams:a}=new URL(e.url),o=a.get("status"),n=a.get("clienteId"),i=Object(function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}()).vendas().where("userId","==",t.id);o&&"todos"!==o&&(i=i.where("status","==",o)),n&&(i=i.where("clienteId","==",n));let s=await i.orderBy("criadoEm","desc").get(),c=await Promise.all(s.docs.map(async e=>{let r=Object(function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(r.clienteId){let e=await Object(function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}()).clientes().doc(r.clienteId).get();e.exists&&(r.cliente={id:e.id,nome:e.data().nome,email:e.data().email})}return r})),u={total:c.reduce((e,r)=>e+(r.valor||0),0),pendente:c.filter(e=>"pendente"===e.status).reduce((e,r)=>e+r.valor,0),pago:c.filter(e=>"pago"===e.status).reduce((e,r)=>e+r.valor,0),cancelado:c.filter(e=>"cancelado"===e.status).reduce((e,r)=>e+r.valor,0)};return d.NextResponse.json({success:!0,vendas:c,total:c.length,totais:u})}catch(e){return console.error("Erro ao buscar vendas:",e),d.NextResponse.json({error:"Erro ao buscar vendas"},{status:500})}}async function c(e){try{let r=await Object(function(){var e=Error("Cannot find module '@/lib/middleware/auth'");throw e.code="MODULE_NOT_FOUND",e}())(e);if(r.error)return d.NextResponse.json({error:r.error},{status:r.status});let{user:t}=r,a=await e.json(),o=await Object(function(){var e=Error("Cannot find module '@/lib/utils/validation'");throw e.code="MODULE_NOT_FOUND",e}())(Object(function(){var e=Error("Cannot find module '@/lib/utils/validation'");throw e.code="MODULE_NOT_FOUND",e}()),a);if(!o.success)return d.NextResponse.json({error:"Dados inv\xe1lidos",details:o.errors},{status:400});if(!(await Object(function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}()).clientes().doc(o.data.clienteId).get()).exists)return d.NextResponse.json({error:"Cliente n\xe3o encontrado"},{status:404});let n={...o.data,userId:t.id,dataVenda:o.data.dataVenda||new Date().toISOString(),criadoEm:new Date().toISOString(),atualizadoEm:new Date().toISOString()},i=await Object(function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}()).vendas().add(n);return await Object(function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}()).atividades().add({userId:t.id,tipo:"venda",descricao:`Nova venda registrada: R$ ${o.data.valor.toLocaleString("pt-BR")}`,criadoEm:new Date().toISOString()}),d.NextResponse.json({success:!0,message:"Venda criada com sucesso",vendaId:i.id},{status:201})}catch(e){return console.error("Erro ao criar venda:",e),d.NextResponse.json({error:"Erro ao criar venda"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/middleware/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/firebase/admin'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/utils/validation'");throw e.code="MODULE_NOT_FOUND",e}();let u=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/vendas/route",pathname:"/api/vendas",filename:"route",bundlePath:"app/api/vendas/route"},resolvedPagePath:"C:\\Users\\luisc\\Documents\\PROJETOS\\crm-sistema\\app\\api\\vendas\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:O,serverHooks:m}=u,f="/api/vendas/route";function v(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:O})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9276,5972],()=>t(8451));module.exports=a})();